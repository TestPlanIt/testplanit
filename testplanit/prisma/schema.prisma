//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Theme {
  Light
  Dark
  System
  Green
  Orange
  Purple
}

enum ItemsPerPage {
  P10  @map("10")
  P25  @map("25")
  P50  @map("50")
  P100 @map("100")
  P250 @map("250")
}

enum Locale {
  en_US
  es_ES
  fr_FR
}

enum DateFormat {
  MM_DD_YYYY_SLASH
  MM_DD_YYYY_DASH
  DD_MM_YYYY_SLASH
  DD_MM_YYYY_DASH
  YYYY_MM_DD
  MMM_D_YYYY
  D_MMM_YYYY
}

enum TimeFormat {
  HH_MM
  HH_MM_A
  HH_MM_Z
  HH_MM_Z_A
}

enum Access {
  NONE
  USER
  PROJECTADMIN
  ADMIN
}

enum NotificationMode {
  NONE
  IN_APP
  IN_APP_EMAIL_IMMEDIATE
  IN_APP_EMAIL_DAILY
  USE_GLOBAL
}

enum NotificationType {
  WORK_ASSIGNED
  SESSION_ASSIGNED
  SYSTEM_ANNOUNCEMENT
  USER_REGISTERED
  COMMENT_MENTION
  MILESTONE_DUE_REMINDER
  SHARE_LINK_ACCESSED
}

enum WorkflowType {
  NOT_STARTED
  IN_PROGRESS
  DONE
}

enum WorkflowScope {
  CASES
  RUNS
  SESSIONS
}

enum RepositoryCaseSource {
  MANUAL
  JUNIT
  TESTNG
  XUNIT
  NUNIT
  MSTEST
  MOCHA
  CUCUMBER
  API
}

enum LinkType {
  SAME_TEST_DIFFERENT_SOURCE
  DEPENDS_ON
}

enum TestRunType {
  REGULAR
  JUNIT
  TESTNG
  XUNIT
  NUNIT
  MSTEST
  MOCHA
  CUCUMBER
}

enum IntegrationProvider {
  JIRA
  GITHUB
  AZURE_DEVOPS
  SIMPLE_URL
}

enum LlmProvider {
  OPENAI
  ANTHROPIC
  AZURE_OPENAI
  GEMINI
  OLLAMA
  CUSTOM_LLM
}

enum IntegrationAuthType {
  NONE
  OAUTH2
  PERSONAL_ACCESS_TOKEN
  API_KEY
}

enum IntegrationStatus {
  ACTIVE
  INACTIVE
  ERROR
}

enum ApplicationArea {
  Documentation
  Milestones
  TestCaseRepository
  TestCaseRestrictedFields
  TestRuns
  ClosedTestRuns
  TestRunResults
  TestRunResultRestrictedFields
  Sessions
  SessionsRestrictedFields
  ClosedSessions
  SessionResults
  Tags
  SharedSteps
  Issues
  IssueIntegration
  Forecasting
  Reporting
  Settings
}

enum ProjectAccessType {
  DEFAULT
  NO_ACCESS
  GLOBAL_ROLE
  SPECIFIC_ROLE
}

enum JUnitResultType {
  PASSED
  FAILURE
  ERROR
  SKIPPED
}

enum JUnitAttachmentType {
  FILE
  URL
  INLINE
}

enum ShareLinkMode {
  AUTHENTICATED
  PUBLIC
  PASSWORD_PROTECTED
}

enum ShareLinkEntityType {
  REPORT
  TEST_CASE
  TEST_RUN
  SESSION
  DASHBOARD
}

enum SsoProviderType {
  GOOGLE
  SAML
  APPLE
  MAGIC_LINK
}

enum AuthMethod {
  INTERNAL
  SSO
  BOTH
}

enum TestmoImportStatus {
  QUEUED
  RUNNING
  READY
  COMPLETED
  FAILED
  CANCELED
}

enum TestmoImportPhase {
  UPLOADING
  ANALYZING
  CONFIGURING
  IMPORTING
  FINALIZING
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  BULK_CREATE
  BULK_UPDATE
  BULK_DELETE
  LOGIN
  LOGOUT
  LOGIN_FAILED
  SESSION_INVALIDATED
  PASSWORD_CHANGED
  PASSWORD_RESET
  PERMISSION_GRANT
  PERMISSION_REVOKE
  ROLE_CHANGED
  API_KEY_CREATED
  API_KEY_DELETED
  API_KEY_REGENERATED
  API_KEY_REVOKED
  DATA_EXPORTED
  SSO_CONFIG_CHANGED
  SYSTEM_CONFIG_CHANGED
  SHARE_LINK_CREATED
  SHARE_LINK_ACCESSED
  SHARE_LINK_REVOKED
}

model AppConfig {
  key   String @id()
  value Json
}

model Account {
  id                String  @id() @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text()
  access_token      String? @db.Text()
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text()
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique()
  expires    DateTime

  @@unique([identifier, token])
}

model User {
  id                      String                  @id() @default(cuid())
  name                    String
  email                   String                  @unique()
  emailVerified           DateTime?
  emailVerifToken         String?
  emailTokenExpires       DateTime?
  password                String
  image                   String?
  accounts                Account[]
  authMethod              AuthMethod              @default(INTERNAL)
  externalId              String?
  access                  Access                  @default(NONE)
  roleId                  Int                     @default(1)
  role                    Roles                   @relation(fields: [roleId], references: [id])
  isActive                Boolean                 @default(true)
  isDeleted               Boolean                 @default(false)
  isApi                   Boolean                 @default(false)
  createdAt               DateTime                @default(now()) @db.Timestamptz(6)
  createdById             String?
  createdBy               User?                   @relation("UserCreator", fields: [createdById], references: [id])
  updatedAt               DateTime                @updatedAt()
  userPreferences         UserPreferences?
  createdUsers            User[]                  @relation("UserCreator")
  projects                ProjectAssignment[]
  createdProjects         Projects[]              @relation("ProjectCreator")
  groups                  GroupAssignment[]
  createdMilestones       Milestones[]
  repositoryFolders       RepositoryFolders[]
  repositoryCases         RepositoryCases[]
  attachments             Attachments[]
  assignedSessions        Sessions[]              @relation("SessionAssignedTo")
  createdSessions         Sessions[]              @relation("SessionCreatedBy")
  sessionResults          SessionResults[]
  testRunCreatedBy        TestRuns[]              @relation("TestRunCreatedBy")
  testRunCasesAssigned    TestRunCases[]
  testRunResults          TestRunResults[]
  editedTestRunResults    TestRunResults[]        @relation("TestRunResultEditor")
  createdIssues           Issue[]                 @relation("IssueCreator")
  projectPermissions      UserProjectPermission[]
  junitTestSuites         JUnitTestSuite[]
  junitTestResults        JUnitTestResult[]
  junitProperties         JUnitProperty[]
  junitAttachments        JUnitAttachment[]
  junitTestSteps          JUnitTestStep[]
  createdCaseLinks        RepositoryCaseLink[]    @relation("UserCreatedCaseLinks")
  createdSharedStepGroups SharedStepGroup[]
  notifications           Notification[]
  userIntegrationAuths    UserIntegrationAuth[]
  createdEmailDomains     AllowedEmailDomain[]
  lastActiveAt            DateTime?
  lastSeenVersion         String?
  llmUsages               LlmUsage[]
  testmoImportJobs        TestmoImportJob[]
  createdComments         Comment[]               @relation("CommentCreator")
  commentMentions         CommentMention[]        @relation("CommentMentions")
  apiTokens               ApiToken[]
  createdShareLinks       ShareLink[]             @relation("ShareLinkCreator")
  shareLinkAccessLogs     ShareLinkAccessLog[]    @relation("ShareLinkAccessor")
  twoFactorEnabled        Boolean                 @default(false)
  twoFactorSecret         String?
  twoFactorBackupCodes    String?

  @@index([isActive, isDeleted])
  @@index([access])
}

model UserPreferences {
  id                                  String           @id() @default(uuid())
  userId                              String           @unique()
  user                                User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  theme                               Theme            @default(Purple)
  itemsPerPage                        ItemsPerPage     @default(P10)
  locale                              Locale           @default(en_US)
  dateFormat                          DateFormat       @default(MM_DD_YYYY_DASH)
  timeFormat                          TimeFormat       @default(HH_MM_A)
  timezone                            String           @default("Etc/UTC")
  notificationMode                    NotificationMode @default(USE_GLOBAL)
  emailNotifications                  Boolean          @default(true)
  inAppNotifications                  Boolean          @default(true)
  hasCompletedWelcomeTour             Boolean          @default(false)
  hasCompletedInitialPreferencesSetup Boolean          @default(false)
}

model ApiToken {
  id          String    @id() @default(cuid())
  name        String
  token       String    @unique()
  tokenPrefix String
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  scopes      String[]  @default([])
  expiresAt   DateTime?
  lastUsedAt  DateTime?
  lastUsedIp  String?
  createdAt   DateTime  @default(now()) @db.Timestamptz(6)
  isActive    Boolean   @default(true)

  @@index([userId])
  @@index([token])
  @@index([isActive, expiresAt])
}

model Groups {
  id                 Int                      @id() @default(autoincrement())
  name               String                   @unique()
  externalId         String?
  url                String?
  note               String?
  isDeleted          Boolean                  @default(false)
  assignedUsers      GroupAssignment[]
  projectPermissions GroupProjectPermission[]
}

model GroupAssignment {
  userId  String
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  groupId Int
  group   Groups @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([userId, groupId])
}

model Roles {
  id                      Int                      @id() @default(autoincrement())
  name                    String                   @unique()
  isDefault               Boolean                  @default(false)
  isDeleted               Boolean                  @default(false)
  users                   User[]
  rolePermissions         RolePermission[]
  defaultForProjects      Projects[]               @relation("ProjectDefaultRole")
  userProjectPermissions  UserProjectPermission[]  @relation("UserProjectRole")
  groupProjectPermissions GroupProjectPermission[] @relation("GroupProjectRole")
}

model Projects {
  id                     Int                         @id() @default(autoincrement())
  name                   String                      @unique()
  iconUrl                String?
  note                   String?
  docs                   String?
  isCompleted            Boolean                     @default(false)
  isDeleted              Boolean                     @default(false)
  completedAt            DateTime?                   @db.Date()
  createdAt              DateTime                    @default(now()) @db.Timestamptz(6)
  createdBy              String
  creator                User                        @relation("ProjectCreator", fields: [createdBy], references: [id])
  assignedUsers          ProjectAssignment[]
  assignedStatuses       ProjectStatusAssignment[]
  milestoneTypes         MilestoneTypesAssignment[]
  assignedTemplates      TemplateProjectAssignment[]
  assignedWorkflows      ProjectWorkflowAssignment[]
  milestones             Milestones[]
  repositories           Repositories[]
  repositoryFolders      RepositoryFolders[]
  repositoryCases        RepositoryCases[]
  repositoryCaseVersions RepositoryCaseVersions[]
  sessions               Sessions[]
  sessionVersions        SessionVersions[]
  testRuns               TestRuns[]
  defaultAccessType      ProjectAccessType           @default(GLOBAL_ROLE)
  defaultRoleId          Int?
  defaultRole            Roles?                      @relation("ProjectDefaultRole", fields: [defaultRoleId], references: [id])
  userPermissions        UserProjectPermission[]
  groupPermissions       GroupProjectPermission[]
  sharedStepGroups       SharedStepGroup[]
  projectIntegrations    ProjectIntegration[]
  projectLlmIntegrations ProjectLlmIntegration[]
  issues                 Issue[]
  llmUsages              LlmUsage[]
  llmFeatureConfigs      LlmFeatureConfig[]
  llmResponseCaches      LlmResponseCache[]
  comments               Comment[]
  auditLogs              AuditLog[]
  shareLinks             ShareLink[]

  @@index([isDeleted, isCompleted])
  @@index([createdBy])
}

model ProjectAssignment {
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  projectId Int
  project   Projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@id([userId, projectId])
  @@index([projectId])
  @@index([userId])
}

model ProjectStatusAssignment {
  statusId  Int
  status    Status   @relation(fields: [statusId], references: [id])
  projectId Int
  project   Projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@id([statusId, projectId])
}

model ProjectWorkflowAssignment {
  workflowId Int
  workflow   Workflows @relation(fields: [workflowId], references: [id])
  projectId  Int
  project    Projects  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@id([workflowId, projectId])
}

model Milestones {
  id                  Int            @id() @default(autoincrement())
  projectId           Int
  project             Projects       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  rootId              Int?
  root                Milestones?    @relation("MilestoneRoot", fields: [rootId], references: [id])
  descendants         Milestones[]   @relation("MilestoneRoot")
  parentId            Int?
  parent              Milestones?    @relation("MilestoneParent", fields: [parentId], references: [id], onDelete: Cascade)
  children            Milestones[]   @relation("MilestoneParent")
  milestoneType       MilestoneTypes @relation(fields: [milestoneTypesId], references: [id])
  milestoneTypesId    Int
  name                String
  note                Json?
  docs                Json?
  isStarted           Boolean        @default(false)
  isCompleted         Boolean        @default(false)
  isDeleted           Boolean        @default(false)
  automaticCompletion Boolean        @default(false)
  notifyDaysBefore    Int            @default(0)
  startedAt           DateTime?      @db.Timestamptz(6)
  completedAt         DateTime?      @db.Timestamptz(6)
  createdAt           DateTime       @default(now()) @db.Timestamptz(6)
  creator             User           @relation(fields: [createdBy], references: [id])
  createdBy           String
  sessions            Sessions[]
  testRuns            TestRuns[]
  comments            Comment[]

  @@index([projectId, isDeleted])
  @@index([parentId])
  @@index([isCompleted, isDeleted])
  @@index([isCompleted, automaticCompletion, completedAt])
  @@index([isCompleted, notifyDaysBefore, completedAt])
}

model MilestoneTypes {
  id         Int                        @id() @default(autoincrement())
  name       String                     @unique()
  iconId     Int?
  icon       FieldIcon?                 @relation(fields: [iconId], references: [id], onDelete: SetNull)
  isDefault  Boolean                    @default(false)
  isDeleted  Boolean                    @default(false)
  projects   MilestoneTypesAssignment[]
  milestones Milestones[]
}

model MilestoneTypesAssignment {
  projectId       Int
  project         Projects       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  milestoneTypeId Int
  milestoneType   MilestoneTypes @relation(fields: [milestoneTypeId], references: [id])

  @@id([projectId, milestoneTypeId])
}

model FieldIcon {
  id             Int              @id() @default(autoincrement())
  name           String           @unique()
  fieldOptions   FieldOptions[]
  workflows      Workflows[]
  milestoneTypes MilestoneTypes[]
}

model ColorFamily {
  id     Int     @id() @default(autoincrement())
  name   String
  order  Int     @default(0)
  colors Color[]

  @@unique([name])
  @@unique([order])
}

model Color {
  id            Int            @id() @default(autoincrement())
  colorFamilyId Int
  colorFamily   ColorFamily    @relation(fields: [colorFamilyId], references: [id])
  value         String
  order         Int            @default(0)
  fieldOptions  FieldOptions[]
  statuses      Status[]
  workflows     Workflows[]

  @@unique([colorFamilyId, order], name: "colorFamilyId_order")
}

model CaseFields {
  id                 Int                      @id() @default(autoincrement())
  displayName        String
  systemName         String                   @unique()
  hint               String?
  typeId             Int
  type               CaseFieldTypes           @relation(name: "TypeToCaseFields", fields: [typeId], references: [id])
  isEnabled          Boolean                  @default(true)
  isDeleted          Boolean                  @default(false)
  isRequired         Boolean                  @default(false)
  isRestricted       Boolean                  @default(false)
  defaultValue       String?
  isChecked          Boolean?
  minValue           Float?
  maxValue           Float?
  initialHeight      Int?
  templates          TemplateCaseAssignment[]
  fieldOptions       CaseFieldAssignment[]
  caseFieldValues    CaseFieldValues[]
  sessionFieldValues SessionFieldValues[]
}

model ResultFields {
  id                Int                        @id() @default(autoincrement())
  displayName       String
  systemName        String                     @unique()
  hint              String?
  typeId            Int
  type              CaseFieldTypes             @relation(name: "TypeToResultFields", fields: [typeId], references: [id])
  isEnabled         Boolean                    @default(true)
  isDeleted         Boolean                    @default(false)
  isRequired        Boolean                    @default(false)
  isRestricted      Boolean                    @default(false)
  defaultValue      String?
  isChecked         Boolean?
  minValue          Float?
  maxValue          Float?
  initialHeight     Int?
  templates         TemplateResultAssignment[]
  fieldOptions      ResultFieldAssignment[]
  resultFieldValues ResultFieldValues[]
}

model FieldOptions {
  id           Int                     @id() @default(autoincrement())
  name         String
  iconId       Int?
  icon         FieldIcon?              @relation(fields: [iconId], references: [id], onDelete: SetNull)
  isEnabled    Boolean                 @default(true)
  isDeleted    Boolean                 @default(false)
  iconColorId  Int?
  iconColor    Color?                  @relation(fields: [iconColorId], references: [id], onDelete: SetNull)
  isDefault    Boolean                 @default(false)
  caseFields   CaseFieldAssignment[]
  resultFields ResultFieldAssignment[]
  order        Int                     @default(0)
}

model CaseFieldTypes {
  id           Int            @id() @default(autoincrement())
  type         String         @unique()
  caseFields   CaseFields[]   @relation("TypeToCaseFields")
  resultFields ResultFields[] @relation("TypeToResultFields")
  options      Json?
}

model Templates {
  id              Int                         @id() @default(autoincrement())
  templateName    String                      @unique()
  isEnabled       Boolean
  isDeleted       Boolean                     @default(false)
  isDefault       Boolean
  caseFields      TemplateCaseAssignment[]
  resultFields    TemplateResultAssignment[]
  projects        TemplateProjectAssignment[]
  repositoryCases RepositoryCases[]
  sessions        Sessions[]
}

model TemplateProjectAssignment {
  templateId Int
  template   Templates @relation(fields: [templateId], references: [id])
  projectId  Int
  project    Projects  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@id([templateId, projectId])
}

model TemplateCaseAssignment {
  caseFieldId Int
  caseField   CaseFields @relation(fields: [caseFieldId], references: [id], onDelete: Cascade)
  templateId  Int
  template    Templates  @relation(fields: [templateId], references: [id], onDelete: Cascade)
  order       Int        @default(0)

  @@id([caseFieldId, templateId])
}

model TemplateResultAssignment {
  resultFieldId Int
  resultField   ResultFields @relation(fields: [resultFieldId], references: [id], onDelete: Cascade)
  templateId    Int
  template      Templates    @relation(fields: [templateId], references: [id], onDelete: Cascade)
  order         Int          @default(0)

  @@id([resultFieldId, templateId])
}

model CaseFieldAssignment {
  fieldOptionId Int          @default(autoincrement())
  fieldOption   FieldOptions @relation(fields: [fieldOptionId], references: [id], onDelete: Cascade)
  caseFieldId   Int
  caseField     CaseFields   @relation(fields: [caseFieldId], references: [id], onDelete: Cascade)

  @@id([fieldOptionId, caseFieldId])
}

model ResultFieldAssignment {
  fieldOptionId Int          @default(autoincrement())
  fieldOption   FieldOptions @relation(fields: [fieldOptionId], references: [id], onDelete: Cascade)
  resultFieldId Int
  resultField   ResultFields @relation(fields: [resultFieldId], references: [id], onDelete: Cascade)
  order         Int          @default(0)

  @@id([fieldOptionId, resultFieldId])
}

model Status {
  id                 Int                       @id() @default(autoincrement())
  order              Int                       @default(autoincrement())
  name               String
  systemName         String                    @unique()
  aliases            String?
  colorId            Int
  color              Color                     @relation(fields: [colorId], references: [id])
  isDeleted          Boolean                   @default(false)
  isEnabled          Boolean
  isSuccess          Boolean
  isFailure          Boolean
  isCompleted        Boolean
  scope              StatusScopeAssignment[]
  projects           ProjectStatusAssignment[]
  sessionResults     SessionResults[]
  testRunCases       TestRunCases[]
  testRunResults     TestRunResults[]
  testRunStepResults TestRunStepResults[]
  junitTestResults   JUnitTestResult[]
  junitTestSteps     JUnitTestStep[]           @relation("JUnitTestStepStatus")

  @@index([isDeleted, isEnabled])
  @@index([order])
}

model StatusScope {
  id       Int                     @id() @default(autoincrement())
  name     String                  @unique()
  icon     String?
  statuses StatusScopeAssignment[]
}

model StatusScopeAssignment {
  statusId Int
  status   Status      @relation(fields: [statusId], references: [id], onDelete: Cascade)
  scopeId  Int
  scope    StatusScope @relation(fields: [scopeId], references: [id])

  @@id([statusId, scopeId])
}

model Workflows {
  id              Int                         @id() @default(autoincrement())
  order           Int                         @default(autoincrement())
  name            String
  iconId          Int
  icon            FieldIcon                   @relation(fields: [iconId], references: [id])
  colorId         Int
  color           Color                       @relation(fields: [colorId], references: [id])
  isEnabled       Boolean                     @default(true)
  isDeleted       Boolean                     @default(false)
  isDefault       Boolean                     @default(false)
  workflowType    WorkflowType                @default(NOT_STARTED)
  scope           WorkflowScope
  projects        ProjectWorkflowAssignment[]
  repositoryCases RepositoryCases[]
  sessions        Sessions[]
  testRuns        TestRuns[]

  @@index([isDeleted, isEnabled])
  @@index([scope, isDefault])
  @@index([order])
}

model ConfigCategories {
  id        Int              @id() @default(autoincrement())
  name      String
  isDeleted Boolean          @default(false)
  variants  ConfigVariants[]
}

model ConfigVariants {
  id             Int                          @id() @default(autoincrement())
  name           String
  isEnabled      Boolean                      @default(true)
  isDeleted      Boolean                      @default(false)
  categoryId     Int
  category       ConfigCategories             @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  configurations ConfigurationConfigVariant[]
}

model Configurations {
  id        Int                          @id() @default(autoincrement())
  name      String
  isEnabled Boolean                      @default(true)
  isDeleted Boolean                      @default(false)
  variants  ConfigurationConfigVariant[]
  sessions  Sessions[]
  testRuns  TestRuns[]
}

model ConfigurationConfigVariant {
  configurationId Int
  configuration   Configurations @relation(fields: [configurationId], references: [id], onDelete: Cascade)
  variantId       Int
  variant         ConfigVariants @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@id([configurationId, variantId])
}

model Tags {
  id              Int               @id() @default(autoincrement())
  name            String            @unique()
  isDeleted       Boolean           @default(false)
  repositoryCases RepositoryCases[]
  sessions        Sessions[]
  testRuns        TestRuns[]
}

model Repositories {
  id         Int                 @id() @default(autoincrement())
  projectId  Int
  project    Projects            @relation(fields: [projectId], references: [id], onDelete: Cascade)
  isActive   Boolean             @default(true)
  isArchived Boolean             @default(false)
  isDeleted  Boolean             @default(false)
  folders    RepositoryFolders[]
  cases      RepositoryCases[]
}

model RepositoryFolders {
  id           Int                 @id() @default(autoincrement())
  projectId    Int
  project      Projects            @relation(fields: [projectId], references: [id], onDelete: Cascade)
  repositoryId Int
  repository   Repositories        @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  parentId     Int?
  parent       RepositoryFolders?  @relation("RepositoryFolderParent", fields: [parentId], references: [id], onDelete: Cascade)
  children     RepositoryFolders[] @relation("RepositoryFolderParent")
  name         String
  docs         Json?
  createdAt    DateTime            @default(now()) @db.Timestamptz(6)
  creatorId    String
  creator      User                @relation(fields: [creatorId], references: [id])
  order        Int                 @default(0)
  isDeleted    Boolean             @default(false)
  cases        RepositoryCases[]

  @@unique([projectId, repositoryId, parentId, name, isDeleted])
  @@index([projectId, repositoryId, isDeleted])
  @@index([parentId])
  @@index([order])
}

model RepositoryCaseLink {
  id          Int             @id() @default(autoincrement())
  caseAId     Int
  caseA       RepositoryCases @relation("CaseALinks", fields: [caseAId], references: [id], onDelete: Cascade)
  caseBId     Int
  caseB       RepositoryCases @relation("CaseBLinks", fields: [caseBId], references: [id], onDelete: Cascade)
  type        LinkType
  isDeleted   Boolean         @default(false)
  createdAt   DateTime        @default(now())
  createdById String
  createdBy   User            @relation("UserCreatedCaseLinks", fields: [createdById], references: [id])

  @@unique([caseAId, caseBId, type])
}

model RepositoryCases {
  id                     Int                      @id() @default(autoincrement())
  projectId              Int
  project                Projects                 @relation(fields: [projectId], references: [id], onDelete: Cascade)
  repositoryId           Int
  repository             Repositories             @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  folderId               Int
  folder                 RepositoryFolders        @relation(fields: [folderId], references: [id], onDelete: Cascade)
  templateId             Int
  template               Templates                @relation(fields: [templateId], references: [id])
  name                   String
  className              String?
  source                 RepositoryCaseSource     @default(MANUAL)
  stateId                Int
  state                  Workflows                @relation(fields: [stateId], references: [id])
  estimate               Int?
  forecastManual         Int?
  forecastAutomated      Float?
  order                  Int                      @default(0)
  createdAt              DateTime                 @default(now()) @db.Timestamptz(6)
  creatorId              String
  creator                User                     @relation(fields: [creatorId], references: [id])
  automated              Boolean                  @default(false)
  isArchived             Boolean                  @default(false)
  isDeleted              Boolean                  @default(false)
  currentVersion         Int                      @default(1)
  repositoryCaseVersions RepositoryCaseVersions[]
  caseFieldValues        CaseFieldValues[]
  resultFieldValues      ResultFieldValues[]
  attachments            Attachments[]
  steps                  Steps[]
  testRuns               TestRunCases[]
  tags                   Tags[]
  issues                 Issue[]
  junitResults           JUnitTestResult[]        @relation("JUnitResultCase")
  junitProperties        JUnitProperty[]          @relation("JUnitPropertyCase")
  junitAttachments       JUnitAttachment[]        @relation("JUnitAttachmentCase")
  junitTestSteps         JUnitTestStep[]          @relation("JUnitTestStepCase")
  linksFrom              RepositoryCaseLink[]     @relation("CaseALinks")
  linksTo                RepositoryCaseLink[]     @relation("CaseBLinks")
  comments               Comment[]

  @@unique([projectId, name, className, source])
  @@index([projectId, isDeleted, isArchived])
  @@index([folderId, order])
  @@index([repositoryId, isDeleted])
  @@index([stateId])
  @@index([automated])
  @@index([createdAt])
}

model RepositoryCaseVersions {
  id                     Int                      @id() @default(autoincrement())
  repositoryCaseId       Int
  repositoryCase         RepositoryCases          @relation(fields: [repositoryCaseId], references: [id], onDelete: Cascade)
  staticProjectId        Int
  staticProjectName      String
  projectId              Int
  project                Projects                 @relation(fields: [projectId], references: [id], onDelete: Cascade)
  repositoryId           Int
  folderId               Int
  folderName             String
  templateId             Int
  templateName           String
  name                   String
  stateId                Int
  stateName              String
  estimate               Int?
  forecastManual         Int?
  forecastAutomated      Float?
  order                  Int                      @default(0)
  createdAt              DateTime                 @default(now()) @db.Timestamptz(6)
  creatorId              String
  creatorName            String
  automated              Boolean                  @default(false)
  isArchived             Boolean                  @default(false)
  isDeleted              Boolean                  @default(false)
  version                Int
  caseFieldVersionValues CaseFieldVersionValues[]
  steps                  Json?
  tags                   Json?
  issues                 Json?
  links                  Json?
  attachments            Json?

  @@unique([repositoryCaseId, version])
}

model CaseFieldValues {
  id         Int             @id() @default(autoincrement())
  testCaseId Int
  testCase   RepositoryCases @relation(fields: [testCaseId], references: [id], onDelete: Cascade)
  fieldId    Int
  field      CaseFields      @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  value      Json?

  @@index([testCaseId])
  @@index([fieldId])
}

model CaseFieldVersionValues {
  id        Int                    @id() @default(autoincrement())
  versionId Int
  version   RepositoryCaseVersions @relation(fields: [versionId], references: [id])
  field     String
  value     Json?
}

model ResultFieldValues {
  id               Int              @id() @default(autoincrement())
  testCaseId       Int?
  testCase         RepositoryCases? @relation(fields: [testCaseId], references: [id])
  fieldId          Int
  field            ResultFields     @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  value            Json?
  sessionResultsId Int?
  sessionResults   SessionResults?  @relation(fields: [sessionResultsId], references: [id], onDelete: Cascade)
  testRunResultsId Int?
  testRunResults   TestRunResults?  @relation(fields: [testRunResultsId], references: [id], onDelete: Cascade)

  @@index([testRunResultsId])
  @@index([sessionResultsId])
  @@index([fieldId])
}

model Attachments {
  id                  Int                 @id() @default(autoincrement())
  testCaseId          Int?
  testCase            RepositoryCases?    @relation(fields: [testCaseId], references: [id], onDelete: Cascade)
  url                 String
  name                String
  note                String?
  isDeleted           Boolean             @default(false)
  mimeType            String
  size                BigInt
  createdAt           DateTime            @default(now()) @db.Timestamptz(6)
  createdById         String
  createdBy           User                @relation(fields: [createdById], references: [id])
  sessionId           Int?
  session             Sessions?           @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  sessionResults      SessionResults?     @relation(fields: [sessionResultsId], references: [id], onDelete: Cascade)
  sessionResultsId    Int?
  testRuns            TestRuns?           @relation(fields: [testRunsId], references: [id], onDelete: Cascade)
  testRunsId          Int?
  testRunResultsId    Int?
  testRunResults      TestRunResults?     @relation(fields: [testRunResultsId], references: [id], onDelete: Cascade)
  testRunStepResultId Int?
  testRunStepResult   TestRunStepResults? @relation(fields: [testRunStepResultId], references: [id], onDelete: Cascade)
  junitTestResultId   Int?
  junitTestResult     JUnitTestResult?    @relation(fields: [junitTestResultId], references: [id], onDelete: Cascade)
}

model Steps {
  id                Int                  @id() @default(autoincrement())
  isDeleted         Boolean              @default(false)
  step              Json?
  expectedResult    Json?
  testCaseId        Int
  testCase          RepositoryCases      @relation(fields: [testCaseId], references: [id], onDelete: Cascade)
  order             Int                  @default(0)
  stepResults       TestRunStepResults[]
  sharedStepGroupId Int?
  sharedStepGroup   SharedStepGroup?     @relation(fields: [sharedStepGroupId], references: [id], onDelete: SetNull)

  @@index([testCaseId])
  @@index([sharedStepGroupId])
}

model Sessions {
  id                 Int                  @id() @default(autoincrement())
  projectId          Int
  project            Projects             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  templateId         Int
  template           Templates            @relation(fields: [templateId], references: [id])
  name               String
  note               Json?
  mission            Json?
  configId           Int?
  configuration      Configurations?      @relation(fields: [configId], references: [id], onDelete: SetNull)
  milestoneId        Int?
  milestone          Milestones?          @relation(fields: [milestoneId], references: [id], onDelete: SetNull)
  stateId            Int
  state              Workflows            @relation(fields: [stateId], references: [id])
  assignedToId       String?
  assignedTo         User?                @relation("SessionAssignedTo", fields: [assignedToId], references: [id])
  estimate           Int?
  forecastManual     Int?
  forecastAutomated  Float?
  elapsed            Int?
  isCompleted        Boolean              @default(false)
  isDeleted          Boolean              @default(false)
  completedAt        DateTime?
  createdAt          DateTime             @default(now()) @db.Timestamptz(6)
  createdById        String
  createdBy          User                 @relation("SessionCreatedBy", fields: [createdById], references: [id])
  currentVersion     Int                  @default(1)
  sessionResults     SessionResults[]
  sessionFieldValues SessionFieldValues[]
  versions           SessionVersions[]
  attachments        Attachments[]
  tags               Tags[]
  issues             Issue[]
  comments           Comment[]

  @@index([projectId, isDeleted])
  @@index([createdById])
  @@index([assignedToId])
  @@index([stateId])
  @@index([isCompleted, createdAt])
}

model SessionResults {
  id                Int                 @id() @default(autoincrement())
  isDeleted         Boolean             @default(false)
  sessionId         Int
  session           Sessions            @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  resultData        Json?
  createdAt         DateTime            @default(now()) @db.Timestamptz(6)
  createdById       String
  createdBy         User                @relation(fields: [createdById], references: [id])
  statusId          Int
  status            Status              @relation(fields: [statusId], references: [id])
  elapsed           Int?
  attachments       Attachments[]
  resultFieldValues ResultFieldValues[]
  issues            Issue[]

  @@index([sessionId])
  @@index([statusId])
  @@index([createdAt])
}

model SessionVersions {
  id                Int       @id() @default(autoincrement())
  sessionId         Int
  session           Sessions  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  name              String
  staticProjectId   Int
  staticProjectName String
  projectId         Int
  project           Projects  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  templateId        Int
  templateName      String
  configId          Int?
  configurationName String?
  milestoneId       Int?
  milestoneName     String?
  stateId           Int
  stateName         String
  assignedToId      String?
  assignedToName    String?
  createdById       String
  createdByName     String
  estimate          Int?
  forecastManual    Int?
  forecastAutomated Float?
  elapsed           Int?
  note              Json?
  mission           Json?
  isCompleted       Boolean
  completedAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt()
  version           Int
  tags              Json?
  attachments       Json?
  issues            Json?

  @@unique([sessionId, version])
}

model SessionFieldValues {
  id        Int        @id() @default(autoincrement())
  sessionId Int
  session   Sessions   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  fieldId   Int
  field     CaseFields @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  value     Json?

  @@index([sessionId])
  @@index([fieldId])
}

model TestRuns {
  id                   Int              @id() @default(autoincrement())
  projectId            Int
  project              Projects         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  name                 String
  note                 Json?
  docs                 Json?
  configId             Int?
  configuration        Configurations?  @relation(fields: [configId], references: [id], onDelete: SetNull)
  milestoneId          Int?
  milestone            Milestones?      @relation(fields: [milestoneId], references: [id], onDelete: SetNull)
  stateId              Int
  state                Workflows        @relation(fields: [stateId], references: [id])
  forecastManual       Int?
  forecastAutomated    Float?
  elapsed              Int?
  isCompleted          Boolean          @default(false)
  isDeleted            Boolean          @default(false)
  completedAt          DateTime?
  createdAt            DateTime         @default(now()) @db.Timestamptz(6)
  createdById          String
  createdBy            User             @relation("TestRunCreatedBy", fields: [createdById], references: [id])
  attachments          Attachments[]
  testCases            TestRunCases[]
  results              TestRunResults[]
  tags                 Tags[]
  issues               Issue[]
  testRunType          TestRunType      @default(REGULAR)
  junitTestSuites      JUnitTestSuite[]
  comments             Comment[]
  configurationGroupId String?

  @@index([projectId, isDeleted])
  @@index([createdById])
  @@index([stateId])
  @@index([isCompleted, createdAt])
  @@index([testRunType])
  @@index([configurationGroupId])
}

model TestRunCases {
  id               Int              @id() @default(autoincrement())
  testRunId        Int
  testRun          TestRuns         @relation(fields: [testRunId], references: [id], onDelete: Cascade)
  repositoryCaseId Int
  repositoryCase   RepositoryCases  @relation(fields: [repositoryCaseId], references: [id], onDelete: Cascade)
  order            Int              @default(0)
  statusId         Int?
  status           Status?          @relation(fields: [statusId], references: [id])
  assignedToId     String?
  assignedTo       User?            @relation(fields: [assignedToId], references: [id])
  isCompleted      Boolean          @default(false)
  notes            Json?
  startedAt        DateTime?
  completedAt      DateTime?
  elapsed          Int?
  createdAt        DateTime         @default(now()) @db.Timestamptz(6)
  results          TestRunResults[]

  @@unique([testRunId, repositoryCaseId])
  @@index([testRunId])
  @@index([repositoryCaseId])
  @@index([assignedToId])
  @@index([statusId])
  @@index([isCompleted])
}

model TestRunResults {
  id                 Int                  @id() @default(autoincrement())
  testRunId          Int
  testRun            TestRuns             @relation(fields: [testRunId], references: [id], onDelete: Cascade)
  testRunCaseId      Int
  testRunCase        TestRunCases         @relation(fields: [testRunCaseId], references: [id], onDelete: Cascade)
  testRunCaseVersion Int                  @default(1)
  statusId           Int
  status             Status               @relation(fields: [statusId], references: [id])
  executedById       String
  executedBy         User                 @relation(fields: [executedById], references: [id])
  executedAt         DateTime             @default(now()) @db.Timestamptz(6)
  editedById         String?
  editedBy           User?                @relation("TestRunResultEditor", fields: [editedById], references: [id])
  editedAt           DateTime?
  elapsed            Int?
  notes              Json?
  evidence           Json?
  attachments        Attachments[]
  resultFieldValues  ResultFieldValues[]
  attempt            Int                  @default(1)
  stepResults        TestRunStepResults[]
  isDeleted          Boolean              @default(false)
  issues             Issue[]

  @@index([testRunCaseId])
  @@index([executedById])
  @@index([statusId])
  @@index([executedAt])
  @@index([testRunCaseId, executedAt(sort: Desc)])
}

model TestRunStepResults {
  id               Int             @id() @default(autoincrement())
  testRunResultId  Int
  testRunResult    TestRunResults  @relation(fields: [testRunResultId], references: [id])
  stepId           Int
  step             Steps           @relation(fields: [stepId], references: [id], onDelete: Cascade)
  sharedStepItemId Int?
  sharedStepItem   SharedStepItem? @relation(fields: [sharedStepItemId], references: [id], onDelete: SetNull, map: "test_run_step_results_shared_step_item_id_fkey")
  statusId         Int
  stepStatus       Status          @relation(fields: [statusId], references: [id])
  notes            Json?
  evidence         Json?
  executedAt       DateTime        @default(now()) @db.Timestamptz(6)
  elapsed          Int?
  attachments      Attachments[]
  isDeleted        Boolean         @default(false)
  issues           Issue[]

  @@unique([testRunResultId, stepId, sharedStepItemId], map: "uq_tsr_res_step_shareditem")
  @@index([sharedStepItemId])
}

model Issue {
  id                 Int                  @id() @default(autoincrement())
  name               String
  title              String
  description        String?
  status             String?
  priority           String?              @default("medium")
  externalId         String?
  externalKey        String?
  externalUrl        String?
  externalStatus     String?
  externalData       Json?
  issueTypeId        String?
  issueTypeName      String?
  issueTypeIconUrl   String?
  lastSyncedAt       DateTime?            @db.Timestamptz(6)
  data               Json?
  note               Json?
  isDeleted          Boolean              @default(false)
  createdAt          DateTime             @default(now()) @db.Timestamptz(6)
  createdById        String
  createdBy          User                 @relation("IssueCreator", fields: [createdById], references: [id])
  repositoryCases    RepositoryCases[]
  sessions           Sessions[]
  sessionResults     SessionResults[]
  testRuns           TestRuns[]
  testRunResults     TestRunResults[]
  testRunStepResults TestRunStepResults[]
  projectId          Int?
  project            Projects?            @relation(fields: [projectId], references: [id], onDelete: Cascade)
  integrationId      Int?
  integration        Integration?         @relation(fields: [integrationId], references: [id], onDelete: SetNull)

  @@unique([externalId, integrationId])
  @@index([externalId])
  @@index([createdById])
  @@index([projectId])
  @@index([integrationId])
}

model Integration {
  id                   Int                   @id() @default(autoincrement())
  name                 String
  provider             IntegrationProvider
  authType             IntegrationAuthType
  status               IntegrationStatus     @default(INACTIVE)
  credentials          Json
  settings             Json?
  lastSyncAt           DateTime?
  isDeleted            Boolean               @default(false)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt()
  userIntegrationAuths UserIntegrationAuth[]
  projectIntegrations  ProjectIntegration[]
  issues               Issue[]

  @@unique([name])
  @@index([provider, status])
}

model LlmIntegration {
  id                     Int                     @id() @default(autoincrement())
  name                   String
  provider               LlmProvider
  status                 IntegrationStatus       @default(INACTIVE)
  credentials            Json
  settings               Json?
  isDeleted              Boolean                 @default(false)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt()
  llmProviderConfig      LlmProviderConfig?
  ollamaModelRegistry    OllamaModelRegistry[]
  llmUsages              LlmUsage[]
  llmFeatureConfigs      LlmFeatureConfig[]
  llmResponseCaches      LlmResponseCache[]
  projectLlmIntegrations ProjectLlmIntegration[]
  llmPromptTemplates     LlmPromptTemplate[]
  llmRateLimits          LlmRateLimit[]

  @@unique([name])
  @@index([provider, status])
}

model ProjectLlmIntegration {
  id               String         @id() @default(cuid())
  projectId        Int
  project          Projects       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  llmIntegrationId Int
  llmIntegration   LlmIntegration @relation(fields: [llmIntegrationId], references: [id], onDelete: Cascade)
  config           Json?
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime       @updatedAt()

  @@unique([projectId, llmIntegrationId])
  @@index([projectId, isActive])
}

model UserIntegrationAuth {
  id             String      @id() @default(cuid())
  userId         String
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  integrationId  Int
  integration    Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  accessToken    String
  refreshToken   String?
  tokenExpiresAt DateTime?
  additionalData Json?
  isActive       Boolean     @default(true)
  lastUsedAt     DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt()

  @@unique([userId, integrationId])
  @@index([integrationId, isActive])
}

model RolePermission {
  roleId     Int
  role       Roles           @relation(fields: [roleId], references: [id], onDelete: Cascade)
  area       ApplicationArea
  canAddEdit Boolean         @default(false)
  canDelete  Boolean         @default(false)
  canClose   Boolean         @default(false)

  @@id([roleId, area])
}

model UserProjectPermission {
  userId     String
  user       User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  projectId  Int
  project    Projects          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  accessType ProjectAccessType @default(DEFAULT)
  roleId     Int?
  role       Roles?            @relation("UserProjectRole", fields: [roleId], references: [id], onDelete: SetNull)

  @@id([userId, projectId])
}

model GroupProjectPermission {
  groupId    Int
  group      Groups            @relation(fields: [groupId], references: [id], onDelete: Cascade)
  projectId  Int
  project    Projects          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  accessType ProjectAccessType @default(DEFAULT)
  roleId     Int?
  role       Roles?            @relation("GroupProjectRole", fields: [roleId], references: [id], onDelete: SetNull)

  @@id([groupId, projectId])
}

model JUnitTestSuite {
  id          Int               @id() @default(autoincrement())
  name        String
  time        Float?
  tests       Int?
  failures    Int?
  errors      Int?
  skipped     Int?
  assertions  Int?
  timestamp   DateTime?
  file        String?
  properties  JUnitProperty[]
  systemOut   String?
  systemErr   String?
  results     JUnitTestResult[]
  parentId    Int?
  parent      JUnitTestSuite?   @relation("TestSuiteParent", fields: [parentId], references: [id], onDelete: Cascade)
  children    JUnitTestSuite[]  @relation("TestSuiteParent")
  testRunId   Int
  testRun     TestRuns          @relation(fields: [testRunId], references: [id], onDelete: Cascade)
  createdAt   DateTime          @default(now()) @db.Timestamptz(6)
  createdById String
  createdBy   User              @relation(fields: [createdById], references: [id])

  @@index([testRunId])
  @@index([parentId])
}

model JUnitTestResult {
  id               Int             @id() @default(autoincrement())
  type             JUnitResultType
  message          String?
  content          String?
  repositoryCaseId Int
  repositoryCase   RepositoryCases @relation("JUnitResultCase", fields: [repositoryCaseId], references: [id], onDelete: Cascade)
  executedAt       DateTime?       @db.Timestamptz(6)
  time             Float?
  assertions       Int?
  file             String?
  line             Int?
  systemOut        String?
  systemErr        String?
  testSuiteId      Int
  testSuite        JUnitTestSuite  @relation(fields: [testSuiteId], references: [id], onDelete: Cascade)
  createdAt        DateTime        @default(now()) @db.Timestamptz(6)
  createdById      String
  createdBy        User            @relation(fields: [createdById], references: [id])
  statusId         Int?
  status           Status?         @relation(fields: [statusId], references: [id])
  attachments      Attachments[]

  @@index([testSuiteId])
  @@index([repositoryCaseId])
  @@index([repositoryCaseId, executedAt(sort: Desc)])
}

model JUnitProperty {
  id               Int              @id() @default(autoincrement())
  name             String
  value            String?
  testSuiteId      Int?
  testSuite        JUnitTestSuite?  @relation(fields: [testSuiteId], references: [id], onDelete: Cascade)
  repositoryCaseId Int?
  repositoryCase   RepositoryCases? @relation("JUnitPropertyCase", fields: [repositoryCaseId], references: [id], onDelete: Cascade)
  createdAt        DateTime         @default(now()) @db.Timestamptz(6)
  createdById      String
  createdBy        User             @relation(fields: [createdById], references: [id])
}

model JUnitAttachment {
  id               Int                 @id() @default(autoincrement())
  name             String
  value            String
  type             JUnitAttachmentType
  repositoryCaseId Int
  repositoryCase   RepositoryCases     @relation("JUnitAttachmentCase", fields: [repositoryCaseId], references: [id], onDelete: Cascade)
  createdAt        DateTime            @default(now()) @db.Timestamptz(6)
  createdById      String
  createdBy        User                @relation(fields: [createdById], references: [id])
}

model JUnitTestStep {
  id               Int             @id() @default(autoincrement())
  name             String
  content          String?
  statusId         Int?
  stepStatus       Status?         @relation("JUnitTestStepStatus", fields: [statusId], references: [id])
  repositoryCaseId Int
  repositoryCase   RepositoryCases @relation("JUnitTestStepCase", fields: [repositoryCaseId], references: [id], onDelete: Cascade)
  createdAt        DateTime        @default(now()) @db.Timestamptz(6)
  createdById      String
  createdBy        User            @relation(fields: [createdById], references: [id])
}

model SharedStepGroup {
  id               Int              @id() @default(autoincrement())
  name             String
  projectId        Int
  project          Projects         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  isDeleted        Boolean          @default(false)
  deletedAt        DateTime?        @db.Timestamptz(6)
  createdAt        DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime         @updatedAt() @db.Timestamptz(6)
  createdById      String
  createdBy        User             @relation(fields: [createdById], references: [id])
  items            SharedStepItem[]
  placeholderSteps Steps[]

  @@index([projectId])
  @@index([createdById])
}

model SharedStepItem {
  id                 Int                  @id() @default(autoincrement())
  sharedStepGroupId  Int
  sharedStepGroup    SharedStepGroup      @relation(fields: [sharedStepGroupId], references: [id], onDelete: Cascade)
  order              Int
  step               Json
  expectedResult     Json
  createdAt          DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt          DateTime             @updatedAt() @db.Timestamptz(6)
  testRunStepResults TestRunStepResults[]

  @@index([sharedStepGroupId])
}

model Notification {
  id                String           @id() @default(cuid())
  userId            String
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  type              NotificationType
  title             String
  message           String
  data              Json?
  isRead            Boolean          @default(false)
  isDeleted         Boolean          @default(false)
  relatedEntityId   String?
  relatedEntityType String?
  createdAt         DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt         DateTime         @updatedAt()

  @@index([userId, isRead, isDeleted])
  @@index([createdAt])
  @@index([type])
}

model ShareLink {
  id           String               @id() @default(cuid())
  shareKey     String               @unique()
  entityType   ShareLinkEntityType
  entityId     String?
  entityConfig Json?
  projectId    Int?
  project      Projects?            @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdById  String
  createdBy    User                 @relation("ShareLinkCreator", fields: [createdById], references: [id], onDelete: Cascade)
  mode         ShareLinkMode        @default(PUBLIC)
  passwordHash String?
  expiresAt    DateTime?            @db.Timestamptz(6)
  notifyOnView Boolean              @default(false)
  title        String?
  description  String?
  isRevoked    Boolean              @default(false)
  isDeleted    Boolean              @default(false)
  viewCount    Int                  @default(0)
  lastViewedAt DateTime?            @db.Timestamptz(6)
  createdAt    DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime             @updatedAt()
  accessLogs   ShareLinkAccessLog[]

  @@index([shareKey])
  @@index([projectId, createdById])
  @@index([entityType, entityId])
  @@index([isRevoked, expiresAt])
  @@index([isDeleted])
  @@index([createdById])
}

model ShareLinkAccessLog {
  id               String    @id() @default(cuid())
  shareLinkId      String
  shareLink        ShareLink @relation(fields: [shareLinkId], references: [id], onDelete: Cascade)
  accessedById     String?
  accessedBy       User?     @relation("ShareLinkAccessor", fields: [accessedById], references: [id], onDelete: SetNull)
  ipAddress        String?
  userAgent        String?
  wasAuthenticated Boolean   @default(false)
  accessedAt       DateTime  @default(now()) @db.Timestamptz(6)

  @@index([shareLinkId, accessedAt])
  @@index([accessedById])
}

model ProjectIntegration {
  id            String      @id() @default(cuid())
  projectId     Int
  project       Projects    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  integrationId Int
  integration   Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  config        Json?
  fieldMappings Json?
  isActive      Boolean     @default(true)
  lastSyncAt    DateTime?   @db.Timestamptz(6)
  syncStatus    String?
  syncError     String?
  issueCount    Int         @default(0)
  createdAt     DateTime    @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime    @updatedAt()

  @@unique([projectId, integrationId])
  @@index([integrationId])
  @@index([isActive])
}

model LlmProviderConfig {
  id                   Int             @id() @default(autoincrement())
  llmIntegrationId     Int?            @unique()
  llmIntegration       LlmIntegration? @relation(fields: [llmIntegrationId], references: [id], onDelete: Cascade)
  defaultModel         String
  availableModels      Json
  maxTokensPerRequest  Int             @default(4096)
  maxRequestsPerMinute Int             @default(60)
  maxRequestsPerDay    Int?
  costPerInputToken    Decimal         @db.Decimal(10, 8)
  costPerOutputToken   Decimal         @db.Decimal(10, 8)
  monthlyBudget        Decimal?        @db.Decimal(10, 2)
  defaultTemperature   Float           @default(0.7)
  defaultMaxTokens     Int             @default(2048)
  timeout              Int             @default(30000)
  retryAttempts        Int             @default(3)
  streamingEnabled     Boolean         @default(false)
  isDefault            Boolean         @default(false)
  settings             Json?
  createdAt            DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt            DateTime        @updatedAt()
}

model OllamaModelRegistry {
  id               String         @id() @default(cuid())
  llmIntegrationId Int
  llmIntegration   LlmIntegration @relation(fields: [llmIntegrationId], references: [id])
  modelName        String
  modelTag         String         @default("latest")
  modelSize        BigInt?
  digest           String?
  contextWindow    Int            @default(2048)
  capabilities     Json
  quantization     String?
  isInstalled      Boolean        @default(false)
  isPulling        Boolean        @default(false)
  pullProgress     Float?
  lastUsedAt       DateTime?
  installedAt      DateTime?
  createdAt        DateTime       @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime       @updatedAt()

  @@unique([llmIntegrationId, modelName, modelTag])
  @@index([llmIntegrationId, isInstalled])
}

model LlmUsage {
  id               String          @id() @default(cuid())
  llmIntegrationId Int?
  llmIntegration   LlmIntegration? @relation(fields: [llmIntegrationId], references: [id])
  projectId        Int?
  project          Projects?       @relation(fields: [projectId], references: [id])
  userId           String
  user             User            @relation(fields: [userId], references: [id])
  feature          String
  model            String
  promptTokens     Int
  completionTokens Int
  totalTokens      Int
  inputCost        Decimal         @db.Decimal(10, 6)
  outputCost       Decimal         @db.Decimal(10, 6)
  totalCost        Decimal         @db.Decimal(10, 6)
  latency          Int
  success          Boolean
  error            String?
  createdAt        DateTime        @default(now()) @db.Timestamptz(6)

  @@index([llmIntegrationId])
  @@index([projectId])
  @@index([userId])
  @@index([feature])
  @@index([createdAt])
}

model LlmPromptTemplate {
  id               String             @id() @default(cuid())
  name             String
  feature          String
  version          Int                @default(1)
  llmIntegrationId Int?
  llmIntegration   LlmIntegration?    @relation(fields: [llmIntegrationId], references: [id])
  systemPrompt     String             @db.Text()
  userPrompt       String             @db.Text()
  variables        Json
  examples         Json?
  recommendedModel String?
  minContextWindow Int                @default(2048)
  maxOutputTokens  Int                @default(2048)
  temperature      Float              @default(0.7)
  description      String?
  tags             String[]
  isActive         Boolean            @default(true)
  isDefault        Boolean            @default(false)
  createdAt        DateTime           @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime           @updatedAt()
  featureConfigs   LlmFeatureConfig[]

  @@unique([feature, name, version])
  @@index([feature, isActive, isDefault])
  @@index([tags])
}

model LlmFeatureConfig {
  id                String             @id() @default(cuid())
  projectId         Int
  project           Projects           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  feature           String
  enabled           Boolean            @default(false)
  llmIntegrationId  Int?
  llmIntegration    LlmIntegration?    @relation(fields: [llmIntegrationId], references: [id])
  templateId        String?
  template          LlmPromptTemplate? @relation(fields: [templateId], references: [id])
  model             String?
  temperature       Float?
  maxTokens         Int?
  autoTrigger       Boolean            @default(false)
  triggerConditions Json?
  outputFormat      String?
  postProcessing    Json?
  dailyLimit        Int?
  monthlyLimit      Int?
  createdAt         DateTime           @default(now()) @db.Timestamptz(6)
  updatedAt         DateTime           @updatedAt()

  @@unique([projectId, feature])
  @@index([llmIntegrationId])
  @@index([templateId])
}

model LlmResponseCache {
  id               String         @id() @default(cuid())
  feature          String
  model            String
  promptHash       String
  contextHash      String?
  response         Json
  promptTokens     Int
  completionTokens Int
  projectId        Int?
  project          Projects?      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  llmIntegrationId Int
  llmIntegration   LlmIntegration @relation(fields: [llmIntegrationId], references: [id])
  hits             Int            @default(0)
  lastAccessedAt   DateTime       @default(now()) @db.Timestamptz(6)
  expiresAt        DateTime       @db.Timestamptz(6)
  createdAt        DateTime       @default(now()) @db.Timestamptz(6)

  @@unique([feature, model, promptHash, contextHash])
  @@index([expiresAt])
  @@index([lastAccessedAt])
  @@index([projectId, feature])
}

model LlmRateLimit {
  id               String          @id() @default(cuid())
  llmIntegrationId Int?
  llmIntegration   LlmIntegration? @relation(fields: [llmIntegrationId], references: [id])
  scope            String
  scopeId          String?
  feature          String?
  windowType       String
  windowSize       Int
  maxRequests      Int
  maxTokens        Int?
  currentRequests  Int             @default(0)
  currentTokens    Int             @default(0)
  windowStart      DateTime        @default(now()) @db.Timestamptz(6)
  blockOnExceed    Boolean         @default(true)
  queueOnExceed    Boolean         @default(false)
  alertOnExceed    Boolean         @default(false)
  priority         Int             @default(0)
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime        @updatedAt()

  @@unique([scope, scopeId, feature])
  @@index([scope, isActive])
  @@index([windowStart])
}

model SsoProvider {
  id         String             @id() @default(cuid())
  name       String             @unique()
  type       SsoProviderType
  enabled    Boolean            @default(true)
  forceSso   Boolean            @default(false)
  config     Json?
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt()
  samlConfig SamlConfiguration?
}

model AllowedEmailDomain {
  id        String   @id() @default(cuid())
  domain    String   @unique()
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
  createdBy String?
  creator   User?    @relation(fields: [createdBy], references: [id])
}

model RegistrationSettings {
  id                       String   @id() @default(cuid())
  restrictEmailDomains     Boolean  @default(false)
  allowOpenRegistration    Boolean  @default(true)
  defaultAccess            Access   @default(NONE)
  force2FANonSSO           Boolean  @default(false)
  force2FAAllLogins        Boolean  @default(false)
  requireEmailVerification Boolean  @default(true)
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt()
}

model SamlConfiguration {
  id                 String      @id() @default(cuid())
  providerId         String      @unique()
  provider           SsoProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)
  entryPoint         String
  issuer             String
  cert               String      @db.Text()
  callbackUrl        String
  logoutUrl          String?
  attributeMapping   Json
  autoProvisionUsers Boolean     @default(false)
  defaultAccess      Access      @default(USER)
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt()
}

model TestmoImportJob {
  id                     String                @id() @default(cuid())
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt()
  createdById            String
  createdBy              User                  @relation(fields: [createdById], references: [id])
  status                 TestmoImportStatus    @default(QUEUED)
  statusMessage          String?
  phase                  TestmoImportPhase?
  storageKey             String
  storageBucket          String?
  originalFileName       String
  originalFileSize       BigInt?
  totalDatasets          Int?
  processedDatasets      Int                   @default(0)
  totalRows              BigInt?
  processedRows          BigInt                @default(0)
  durationMs             Int?
  startedAt              DateTime?
  completedAt            DateTime?
  canceledAt             DateTime?
  cancelRequested        Boolean               @default(false)
  error                  String?
  processedCount         Int                   @default(0)
  errorCount             Int                   @default(0)
  skippedCount           Int                   @default(0)
  totalCount             Int                   @default(0)
  currentEntity          String?
  estimatedTimeRemaining String?
  processingRate         String?
  activityLog            Json?
  entityProgress         Json?
  options                Json?
  configuration          Json?
  analysis               Json?
  analysisGeneratedAt    DateTime?
  lastImportStartedAt    DateTime?
  datasets               TestmoImportDataset[]

  @@index([createdById])
  @@index([status])
  @@index([createdAt])
}

model TestmoImportDataset {
  id             Int             @id() @default(autoincrement())
  jobId          String
  job            TestmoImportJob @relation(fields: [jobId], references: [id], onDelete: Cascade)
  name           String
  rowCount       Int
  sampleRowCount Int
  truncated      Boolean
  schema         Json?
  sampleRows     Json?
  allRows        Json?
  createdAt      DateTime        @default(now())

  @@index([jobId])
  @@index([name])
}

model TestmoImportStaging {
  id          String   @id() @default(cuid())
  jobId       String
  datasetName String
  rowIndex    Int
  rowData     Json
  fieldName   String?
  fieldValue  String?  @db.Text()
  text1       String?  @db.Text()
  text2       String?  @db.Text()
  text3       String?  @db.Text()
  text4       String?  @db.Text()
  processed   Boolean  @default(false)
  error       String?  @db.Text()
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt()

  @@index([jobId, datasetName, processed])
  @@index([jobId, processed])
  @@index([jobId, datasetName, rowIndex])
}

model TestmoImportMapping {
  id         String   @id() @default(cuid())
  jobId      String
  entityType String
  sourceId   Int
  targetId   String?
  targetType String
  metadata   Json?
  createdAt  DateTime @default(now())

  @@unique([jobId, entityType, sourceId])
  @@index([jobId, entityType])
  @@index([jobId, entityType, sourceId])
}

model Comment {
  id               String           @id() @default(cuid())
  content          Json
  projectId        Int
  project          Projects         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  repositoryCaseId Int?
  repositoryCase   RepositoryCases? @relation(fields: [repositoryCaseId], references: [id], onDelete: Cascade)
  testRunId        Int?
  testRun          TestRuns?        @relation(fields: [testRunId], references: [id], onDelete: Cascade)
  sessionId        Int?
  session          Sessions?        @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  milestoneId      Int?
  milestone        Milestones?      @relation(fields: [milestoneId], references: [id], onDelete: Cascade)
  creatorId        String
  creator          User             @relation("CommentCreator", fields: [creatorId], references: [id])
  createdAt        DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime         @updatedAt()
  isEdited         Boolean          @default(false)
  isDeleted        Boolean          @default(false)
  mentionedUsers   CommentMention[]

  @@index([projectId, isDeleted, createdAt])
  @@index([repositoryCaseId, isDeleted])
  @@index([testRunId, isDeleted])
  @@index([sessionId, isDeleted])
  @@index([milestoneId, isDeleted])
  @@index([creatorId])
}

model CommentMention {
  id        String   @id() @default(cuid())
  commentId String
  comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation("CommentMentions", fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @db.Timestamptz(6)

  @@unique([commentId, userId])
  @@index([userId, createdAt])
  @@index([commentId])
}

model AuditLog {
  id         String      @id() @default(cuid())
  userId     String?     @db.Text()
  userEmail  String?     @db.Text()
  userName   String?     @db.Text()
  action     AuditAction
  entityType String      @db.VarChar(100)
  entityId   String      @db.Text()
  entityName String?     @db.Text()
  changes    Json?
  metadata   Json?
  timestamp  DateTime    @default(now()) @db.Timestamptz(6)
  projectId  Int?
  project    Projects?   @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@index([entityType, entityId])
  @@index([userId, timestamp])
  @@index([projectId, timestamp])
  @@index([timestamp])
  @@index([action])
}
